plugins {
    id "org.jetbrains.kotlin.platform.native" version "1.3.0-rc-146"
}

ext.json   = project('json')
ext.kurl   = project('kurl')

sourceSets.main {
    kotlin.srcDirs += "/src/main"
}

components.main {
    targets = ['linux_x64', 'macos_x64']
    outputKinds = [EXECUTABLE]
    entryPoint = "runtime.main"
    // Targets independent options
    allTargets {
        linkerOpts '-L/common/lib/path'
    }

    dependencies {
        cinterop('libcurl') {
            // Set up compiler options
            compilerOpts '-I/src/main/c_interop'
        }
        cinterop('jansson') {
            // Set up compiler options
            compilerOpts '-I/src/main/c_interop'
        }
    }

}

task runProgram {
    def buildType = 'debug' // Change to 'debug' to run application with debug symbols.
    dependsOn "build"
    doLast {
        def programFile = "build/exe/main/${buildType}/macos_x64/lambda-runtime-kotlin-native.kexe"
        exec {
            executable programFile
            args ''
        }
    }
}